[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/1 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/2 [executing] blocked: Insufficient permissions, try: `juju trust untrusted-postgresql-k8s --scope=cluster`
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] unknown: 
  untrusted-postgresql-k8s/1 [executing] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] unknown: 
  untrusted-postgresql-k8s/1 [executing] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for primary endpoint to be ready
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] unknown: 
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for primary endpoint to be ready
[33mWARNING [0m juju.client.connection:connection.py:578 Receiver: Connection closed, reconnecting
[1m[31mERROR   [0m asyncio:base_events.py:1758 Task exception was never retrieved
future: <Task finished name='Task-1861' coro=<Connection.reconnect() done, defined at /home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py:779> exception=OSError(9, 'Bad file descriptor')>
Traceback (most recent call last):
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 788, in reconnect
    res = await connector(
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 868, in _connect_with_login
    await self._connect(endpoints)
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 817, in _connect
    result = await task
  File "/usr/lib/python3.10/asyncio/tasks.py", line 571, in _wait_for_one
    return f.result()  # May raise f.exception().
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 806, in _try_endpoint
    return await self._open(endpoint, cacert)
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 427, in _open
    return (await websockets.connect(
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/websockets/legacy/client.py", line 647, in __await_impl_timeout__
    return await self.__await_impl__()
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/websockets/legacy/client.py", line 651, in __await_impl__
    _transport, _protocol = await self._create_connection()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 1103, in create_connection
    transport, protocol = await self._create_connection_transport(
  File "/usr/lib/python3.10/asyncio/base_events.py", line 1119, in _create_connection_transport
    sock.setblocking(False)
OSError: [Errno 9] Bad file descriptor
[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Model status:


[32mINFO    [0m pytest_operator.plugin:plugin.py:868 Juju error logs:

unit-untrusted-postgresql-k8s-2: 01:50:33 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-2: 01:50:33 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
controller-0: 01:56:12 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": refreshing application status for "untrusted-postgresql-k8s": Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s": dial tcp 10.152.183.1:443: connect: connection refused - error from a previous attempt: unexpected EOF
unit-untrusted-postgresql-k8s-1: 01:56:16 ERROR unit.untrusted-postgresql-k8s/1.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_sync/connection_pool.py", line 216, in handle_request
    raise exc from None
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_sync/connection_pool.py", line 196, in handle_request
    response = connection.handle_request(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_sync/connection.py", line 99, in handle_request
    raise exc
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_sync/connection.py", line 76, in handle_request
    stream = self._connect(request)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_sync/connection.py", line 154, in _connect
    stream = stream.start_tls(**kwargs)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_backends/sync.py", line 152, in start_tls
    with map_exceptions(exc_map):
  File "/usr/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 104] Connection reset by peer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/./src/charm.py", line 1837, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 548, in main
    manager.run()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 527, in run
    self._emit()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 516, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/observability_libs/v1/kubernetes_service_patch.py", line 277, in _patch
    if self._is_patched(client):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/observability_libs/v1/kubernetes_service_patch.py", line 309, in _is_patched
    service = client.get(Service, name=self.service_name, namespace=self._namespace)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/lightkube/core/client.py", line 140, in get
    return self._client.request("get", res=res, name=name, namespace=namespace)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/lightkube/core/generic_client.py", line 244, in request
    resp = self.send(req)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/lightkube/core/generic_client.py", line 216, in send
    return self._client.send(req, stream=stream)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 104] Connection reset by peer
controller-0: 01:56:17 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:20 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
unit-untrusted-postgresql-k8s-1: 01:56:22 ERROR juju.worker.uniter.operation hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
controller-0: 01:56:23 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:26 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:29 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:33 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:36 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:39 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:43 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:46 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:51 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:56 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:56:59 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:03 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:07 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:10 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:13 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:16 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
unit-untrusted-postgresql-k8s-1: 01:57:19 ERROR unit.untrusted-postgresql-k8s/1.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/model.py", line 3180, in _run
    result = subprocess.run(args, **kwargs)  # type: ignore
  File "/usr/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '('/var/lib/juju/tools/unit-untrusted-postgresql-k8s-1/secret-get', '--label', 'database-peers.untrusted-postgresql-k8s.app', '--format=json')' returned non-zero exit status 1.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/./src/charm.py", line 1837, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 548, in main
    manager.run()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 527, in run
    self._emit()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/main.py", line 513, in _emit
    self.framework.reemit()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/framework.py", line 870, in reemit
    self._reemit()
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/tempo_k8s/v1/charm_tracing.py", line 647, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/./src/charm.py", line 827, in _on_postgresql_pebble_ready
    self.unit.set_workload_version(self._patroni.rock_postgresql_version)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/./src/charm.py", line 1334, in _patroni
    self.get_secret(APP_SCOPE, USER_PASSWORD_KEY),
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/tempo_k8s/v1/charm_tracing.py", line 647, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/./src/charm.py", line 300, in get_secret
    if result := self.peer_relation_data(scope).fetch_my_relation_field(peers.id, key):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1260, in fetch_my_relation_field
    if relation_data := self.fetch_my_relation_data([relation_id], [field], relation_name):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1249, in fetch_my_relation_data
    data[relation.id] = self._fetch_my_specific_relation_data(relation, fields)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 534, in wrapper
    return f(self, *args, **kwargs)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 2083, in _fetch_my_specific_relation_data
    self.component, self.secret_fields, relation, fields
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1817, in secret_fields
    self.static_secret_fields if self.static_secret_fields else self.current_secret_fields
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1836, in current_secret_fields
    if content := self._get_group_secret_contents(relation, group):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 2070, in _get_group_secret_contents
    result = super()._get_group_secret_contents(relation, group, secret_fields)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1000, in _get_group_secret_contents
    if (secret := self._get_relation_secret(relation.id, group)) and (
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 506, in wrapper
    return f(self, *args, **kwargs)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 2059, in _get_relation_secret
    return self.secrets.get(label, secret_uri, legacy_labels=self._previous_labels())
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 706, in get
    if secret.meta:
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 605, in meta
    self._secret_meta = self._model.get_secret(label=label)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/model.py", line 291, in get_secret
    content = self._backend.secret_get(id=id, label=label)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/model.py", line 3545, in secret_get
    result = self._run('secret-get', *args, return_output=True, use_json=True)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-1/charm/venv/ops/model.py", line 3182, in _run
    raise ModelError(e.stderr) from e
ops.model.ModelError: ERROR unable to determine legacy status for namespace "test": Get "https://10.152.183.1:443/api/v1/namespaces/test": dial tcp 10.152.183.1:443: connect: connection refused

controller-0: 01:57:19 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
unit-untrusted-postgresql-k8s-1: 01:57:19 ERROR juju.worker.uniter.operation hook "update-status" (via hook dispatching script: dispatch) failed: exit status 1
controller-0: 01:57:22 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:25 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:28 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:57:31 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused

[32mINFO    [0m pytest_operator.plugin:plugin.py:947 Forgetting model main...