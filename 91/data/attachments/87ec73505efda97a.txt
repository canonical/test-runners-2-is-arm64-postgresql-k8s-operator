[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.1.8    unsupported  01:35:12Z

App                  Version  Status       Scale  Charm                Channel  Rev  Address         Exposed  Message
another-database     14.11    waiting          3  postgresql-k8s                  0  10.152.183.254  no       installing agent
database             14.11    waiting          3  postgresql-k8s                  1  10.152.183.120  no       installing agent
postgresql-test-app           maintenance      2  postgresql-test-app  edge     161  10.152.183.74   no       

Unit                    Workload     Agent      Address       Ports  Message
another-database/0*     waiting      executing  10.1.206.210         (config-changed) awaiting for primary endpoint to be ready
another-database/1      unknown      idle       10.1.206.207         
another-database/2      maintenance  executing  10.1.206.208         (stop) stopping charm software
database/0*             error        idle       10.1.206.211         hook failed: "config-changed"
database/1              unknown      idle       10.1.206.212         
database/2              unknown      idle       10.1.206.213         
postgresql-test-app/0*  active       idle       10.1.206.201         
postgresql-test-app/1   maintenance  executing  10.1.206.200         (start) 

[32mINFO    [0m pytest_operator.plugin:plugin.py:868 Juju error logs:

unit-another-database-1: 01:33:56 ERROR unit.another-database/1.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/model.py", line 3022, in _run
    result = subprocess.run(args, **kwargs)  # type: ignore
  File "/usr/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '('/var/lib/juju/tools/unit-another-database-1/secret-get', '--label', 'database-peers.another-database.app', '--format=json')' returned non-zero exit status 1.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-another-database-1/charm/./src/charm.py", line 1691, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/main.py", line 544, in main
    manager.run()
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/main.py", line 520, in run
    self._emit()
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/main.py", line 509, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/main.py", line 143, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/framework.py", line 352, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/framework.py", line 851, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/framework.py", line 941, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-another-database-1/charm/./src/charm.py", line 731, in _on_postgresql_pebble_ready
    self.unit.set_workload_version(self._patroni.rock_postgresql_version)
  File "/var/lib/juju/agents/unit-another-database-1/charm/./src/charm.py", line 1215, in _patroni
    self.get_secret(APP_SCOPE, REPLICATION_PASSWORD_KEY),
  File "/var/lib/juju/agents/unit-another-database-1/charm/./src/charm.py", line 267, in get_secret
    return self.peer_relation_data(scope).get_secret(peers.id, secret_key)
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 519, in wrapper
    return f(self, *args, **kwargs)
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1871, in get_secret
    and full_field not in self.current_secret_fields
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1832, in current_secret_fields
    if content := self._get_group_secret_contents(relation, group):
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 2066, in _get_group_secret_contents
    result = super()._get_group_secret_contents(relation, group, secret_fields)
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 996, in _get_group_secret_contents
    if (secret := self._get_relation_secret(relation.id, group)) and (
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 506, in wrapper
    return f(self, *args, **kwargs)
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 2055, in _get_relation_secret
    return self.secrets.get(label, secret_uri, legacy_labels=self._previous_labels())
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 702, in get
    if secret.meta:
  File "/var/lib/juju/agents/unit-another-database-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 605, in meta
    self._secret_meta = self._model.get_secret(label=label)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/model.py", line 280, in get_secret
    content = self._backend.secret_get(id=id, label=label)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/model.py", line 3370, in secret_get
    result = self._run('secret-get', *args, return_output=True, use_json=True)
  File "/var/lib/juju/agents/unit-another-database-1/charm/venv/ops/model.py", line 3024, in _run
    raise ModelError(e.stderr) from e
ops.model.ModelError: ERROR permission denied

unit-another-database-1: 01:33:57 ERROR juju.worker.uniter.operation hook "postgresql-pebble-ready" (via hook dispatching script: dispatch) failed: exit status 1
unit-another-database-1: 01:33:57 ERROR juju.worker.uniter pebble poll failed for container "postgresql": failed to send pebble-ready event: hook failed
unit-database-0: 01:35:10 ERROR unit.database/0.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-database-0/charm/./src/charm.py", line 1691, in <module>
    main(PostgresqlOperatorCharm, use_juju_for_storage=True)
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/main.py", line 544, in main
    manager.run()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/main.py", line 520, in run
    self._emit()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/main.py", line 506, in _emit
    self.framework.reemit()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/framework.py", line 861, in reemit
    self._reemit()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/framework.py", line 941, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-database-0/charm/./src/charm.py", line 746, in _on_postgresql_pebble_ready
    self.push_tls_files_to_workload(container)
  File "/var/lib/juju/agents/unit-database-0/charm/./src/charm.py", line 1414, in push_tls_files_to_workload
    return self.update_config()
  File "/var/lib/juju/agents/unit-database-0/charm/./src/charm.py", line 1512, in update_config
    current_layer = container.get_plan()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/model.py", line 2186, in get_plan
    return self._pebble.get_plan()
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/pebble.py", line 2113, in get_plan
    resp = self._request('GET', '/v1/plan', {'format': 'yaml'})
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/pebble.py", line 1778, in _request
    response = self._request_raw(method, path, query, headers, data)
  File "/var/lib/juju/agents/unit-database-0/charm/venv/ops/pebble.py", line 1827, in _request_raw
    raise ConnectionError(
ops.pebble.ConnectionError: Could not connect to Pebble: socket not found at '/charm/containers/postgresql/pebble.socket' (container restarted?)
unit-database-0: 01:35:11 ERROR juju.worker.uniter.operation hook "config-changed" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:947 Forgetting model main...