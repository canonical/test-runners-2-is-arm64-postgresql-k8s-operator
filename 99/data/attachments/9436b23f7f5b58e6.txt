[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] maintenance: installing charm software
  untrusted-postgresql-k8s/1 [executing] blocked: Insufficient permissions, try: `juju trust untrusted-postgresql-k8s --scope=cluster`
  untrusted-postgresql-k8s/2 [executing] maintenance: installing charm software
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [executing] waiting: awaiting for cluster to start
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [executing] waiting: awaiting for primary endpoint to be ready
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] waiting: awaiting for primary endpoint to be ready
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] unknown: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] unknown: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] waiting: awaiting for member to start
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [executing] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] waiting: awaiting for member to start
  untrusted-postgresql-k8s/1 [idle] maintenance: reconfiguring cluster
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for cluster to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for member to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] waiting: awaiting for member to start
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [idle] active: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [executing] maintenance: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] active: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  untrusted-postgresql-k8s/0 [executing] active: 
  untrusted-postgresql-k8s/1 [idle] active: Primary
  untrusted-postgresql-k8s/2 [idle] active: 
[33mWARNING [0m juju.client.connection:connection.py:578 Receiver: Connection closed, reconnecting
[1m[31mERROR   [0m asyncio:base_events.py:1758 Task exception was never retrieved
future: <Task finished name='Task-3263' coro=<Connection.reconnect() done, defined at /home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py:779> exception=OSError(9, 'Bad file descriptor')>
Traceback (most recent call last):
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 788, in reconnect
    res = await connector(
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 868, in _connect_with_login
    await self._connect(endpoints)
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 817, in _connect
    result = await task
  File "/usr/lib/python3.10/asyncio/tasks.py", line 571, in _wait_for_one
    return f.result()  # May raise f.exception().
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 806, in _try_endpoint
    return await self._open(endpoint, cacert)
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/juju/client/connection.py", line 427, in _open
    return (await websockets.connect(
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/websockets/legacy/client.py", line 647, in __await_impl_timeout__
    return await self.__await_impl__()
  File "/home/ubuntu/actions-runner/_work/test-runners-2-is-arm64-postgresql-k8s-operator/test-runners-2-is-arm64-postgresql-k8s-operator/.tox/integration/lib/python3.10/site-packages/websockets/legacy/client.py", line 651, in __await_impl__
    _transport, _protocol = await self._create_connection()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 1103, in create_connection
    transport, protocol = await self._create_connection_transport(
  File "/usr/lib/python3.10/asyncio/base_events.py", line 1119, in _create_connection_transport
    sock.setblocking(False)
OSError: [Errno 9] Bad file descriptor
[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.1.8    unsupported  01:41:47Z

App                       Version  Status  Scale  Charm           Channel  Rev  Address         Exposed  Message
untrusted-postgresql-k8s  14.11    active      3  postgresql-k8s             0  10.152.183.131  no       

Unit                         Workload  Agent  Address       Ports  Message
untrusted-postgresql-k8s/0   active    idle   10.1.235.139         
untrusted-postgresql-k8s/1*  active    idle   10.1.235.141         Primary
untrusted-postgresql-k8s/2   active    idle   10.1.235.140         

[32mINFO    [0m pytest_operator.plugin:plugin.py:868 Juju error logs:

unit-untrusted-postgresql-k8s-1: 01:33:37 ERROR unit.untrusted-postgresql-k8s/1.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-1: 01:33:37 ERROR unit.untrusted-postgresql-k8s/1.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-1: 01:40:54 ERROR juju.worker.caasunitterminationworker error while terminating unit: getting caas client: getting namespace "test": unexpected error when reading response body. Please retry. Original error: unexpected EOF
unit-untrusted-postgresql-k8s-1: 01:40:54 ERROR juju.worker.dependency "caas-unit-termination-worker" manifold worker returned unexpected error: getting caas client: getting namespace "test": unexpected error when reading response body. Please retry. Original error: unexpected EOF
controller-0: 01:40:54 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": Get "https://10.152.183.1:443/api/v1/namespaces/test/services/untrusted-postgresql-k8s": dial tcp 10.152.183.1:443: connect: connection refused
unit-untrusted-postgresql-k8s-0: 01:40:54 ERROR juju.worker.caasunitterminationworker error while terminating unit: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s": dial tcp 10.152.183.1:443: connect: connection refused - error from a previous attempt: unexpected EOF
unit-untrusted-postgresql-k8s-0: 01:40:55 ERROR juju.worker.dependency "caas-unit-termination-worker" manifold worker returned unexpected error: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s": dial tcp 10.152.183.1:443: connect: connection refused - error from a previous attempt: unexpected EOF
controller-0: 01:40:58 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
controller-0: 01:41:01 ERROR juju.worker.caasapplicationprovisioner.runner exited "untrusted-postgresql-k8s": checking if "untrusted-postgresql-k8s" has an operator pod due to upgrading the charm from a pod-spec charm to a sidecar charm: Get "https://10.152.183.1:443/apis/apps/v1/namespaces/test/statefulsets/untrusted-postgresql-k8s-operator": dial tcp 10.152.183.1:443: connect: connection refused
unit-untrusted-postgresql-k8s-2: 01:41:03 ERROR unit.untrusted-postgresql-k8s/2.juju-log 
            Access to k8s cluster resources is not authorized. This happens when RBAC is enabled and the deployed application was not trusted by the juju admin.
            To fix this issue, run `juju trust untrusted-postgresql-k8s --scope=cluster` (or remove & re-deploy untrusted-postgresql-k8s with `--trust`)
            
unit-untrusted-postgresql-k8s-2: 01:41:23 ERROR unit.untrusted-postgresql-k8s/2.juju-log failed to change plugins: 
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 319, in enable_disable_extensions
    cursor.execute(
psycopg2.errors.ReadOnlySqlTransaction: cannot execute DROP EXTENSION in a read-only transaction


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/./src/charm.py", line 639, in enable_disable_extensions
    self.postgresql.enable_disable_extensions(extensions, database)
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/lib/charms/tempo_k8s/v1/charm_tracing.py", line 544, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-untrusted-postgresql-k8s-2/charm/lib/charms/postgresql_k8s/v0/postgresql.py", line 327, in enable_disable_extensions
    raise PostgreSQLEnableDisableExtensionError()
charms.postgresql_k8s.v0.postgresql.PostgreSQLEnableDisableExtensionError

[32mINFO    [0m pytest_operator.plugin:plugin.py:947 Forgetting model main...